<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Airbnb Knowledge Repo</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Some webdev stuff">
	<meta name="generator" content="Hugo 0.52" />
	<meta property="og:title" content="Airbnb Knowledge Repo" />
<meta property="og:description" content="Some webdev stuff" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://data-analytics.netlify.com/airbnb-knowledge-repo/" /><meta property="article:published_time" content="2018-06-25T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-06-25T00:00:00&#43;00:00"/>

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-22322985-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	<link rel="stylesheet" href="https://data-analytics.netlify.com/css/tl.css"><link rel="stylesheet" href="https://data-analytics.netlify.com/css/auto-complete.css">
	<div id="particles-js">
		
	</div>
	<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
	<script src="https://data-analytics.netlify.com/js/particles.js"></script> 

	

	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

	 <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/sql.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/css.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ini.min.js"></script> 

	<script>hljs.initHighlightingOnLoad();</script>

	

	<script type="text/javascript" src="https://data-analytics.netlify.com/js/jquery.js"></script>

	<script type="text/javascript" src="https://data-analytics.netlify.com/js/jquery.sticky.js"></script>
	<script type="text/javascript" src="https://data-analytics.netlify.com/js/tl.js"></script> 

	
</head>
<body class="body">
	
	<div class="sidebar_menu">
		<span onclick="toggleBtnClick()" id="pin_button"><sup><img src="https://data-analytics.netlify.com/img/pin.png" width="25px" class="activated"></sup></span>
		<span onclick="toggleBtnClick2()" id="hide_button"><sup><img src="https://data-analytics.netlify.com/img/eye.png" width="25px" class="activated"></sup></span>
	</div>
	
	<script type="text/javascript" src="https://data-analytics.netlify.com/js/lunr.min.js"></script>
    <script type="text/javascript" src="https://data-analytics.netlify.com/js/auto-complete.js"></script>
            
    <script type="text/javascript">
        var baseurl = "https:\/\/data-analytics.netlify.com\/";
    </script>
    <script type="text/javascript" src="https://data-analytics.netlify.com/js/search.js"></script>
			
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Web Archive" rel="home">
				<div class="logo__title">Web Archive</div>
				<div class="logo__tagline">Thomas Laber</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/book/online-reads/">Online Reads</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/post/">Posts</a>
		</li>
		
		<li class="menu__item">
			<a class="menu__link" href="/categories/book/">Books</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/project/">Projects</a>
		</li>
		<li class="dropdown">
		    <a>
		        
		        <div class="searchbox pull-right">
		        	<input data-search-input id="search-by" type="text" placeholder="&#x1F50E; Search...">
		        </div>
		    </a>
	    </li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Airbnb Knowledge Repo</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
	<time class="meta__text" datetime="2018-06-25T00:00:00">June 25, 2018</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/project" rel="category">project</a></span>
</div>
</div>
		</header>
		<figure class="post__thumbnail">
			<img src="/img/banner/airbnb_know_repo.png" alt="Airbnb Knowledge Repo">
		</figure><div class="content post__content clearfix">
			

<p>The Knowledge Repo project is focused on facilitating the sharing of knowledge between data scientists and other technical roles using data formats and tools that make sense in these professions. It provides various data stores (and utilities to manage them) for &ldquo;knowledge posts&rdquo;, with a particular focus on notebooks (R Markdown and Jupyter / IPython Notebook) to better promote reproducible research.</p>

<ul>
<li>Source <a href="https://github.com/airbnb/knowledge-repo">https://github.com/airbnb/knowledge-repo</a></li>
<li>Tutorial: <a href="https://github.com/airbnb/knowledge-repo/issues/401">https://github.com/airbnb/knowledge-repo/issues/401</a></li>
</ul>

<h2 id="activation">Activation</h2>

<ol>
<li>Docker-compose-relevante Dateien in einen entsprechend autorisierten Zielfolder kopieren, in dem docker-compose-Befehle (vor allem “build“/“up“/“down“) auszuführen sind.</li>
<li>Im Terminal zum Zielfolder navigieren, per <code>docker-compose build</code> Anwendung vorbereiten. Es wird ein git-Repository heruntergeladen („git clone“) und entsprechende Folder erzeugt.</li>
<li>Im Terminal zum Zielfolder navigieren, per <code>docker-compose up</code> Anwendung starten.</li>
<li>Anwendung im Webbrowser ansehen. (siehe <code>SERVER_NAME</code> in der Datei <code>config_defaults.py</code></li>
<li>SCHLIESSEN: <code>STRG + C</code> terminiert den Thread, hinterlässt dabei kritische Informationen im Docker-Compose-System. Erst mit <code>docker-compose down</code> werden alle Informationen gelöscht und ein sauberer Neustart (<code>docker-compose up</code>) möglich.</li>
</ol>

<h2 id="knowledge-repo-in-docker">Knowledge repo in docker</h2>

<p>All of the below files should be placed in your root directory, starting the local server can be done through the commands aliased in the <code>Makefile</code>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#960050;background-color:#1e0010">make</span> run
</code></pre></div>

<p><strong>Note</strong>: I was unable to get the deploy configuration running on my containers, especially with Auth/Logins enabled - if anyone has any success with this then please let me know!</p>

<h3 id="dockerfile">Dockerfile</h3>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">FROM python</span><span style="color:#f92672">:</span>3
<span style="color:#960050;background-color:#1e0010">COPY</span> . /app
<span style="color:#960050;background-color:#1e0010">WORKDIR</span> /app
<span style="color:#960050;background-color:#1e0010">RUN</span> pip install knowledge-repo<span style="color:#f92672">[</span>all<span style="color:#f92672">]</span>
<span style="color:#960050;background-color:#1e0010">RUN</span> pip install --upgrade requests psycopg2 requests_oauthlib flask_login flask_principal

<span style="color:#960050;background-color:#1e0010">CMD</span> bash /app/start.sh
</code></pre></div>

<h3 id="start-sh">start.sh</h3>

<p>This clones your git post store (delete if necessary) and starts the server based on the <code>RUNTIME_CONTEXT</code> environment variable passed in <code>docker-compose</code>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
echo
echo <span style="color:#e6db74">&#34;Setting up server&#34;</span>
echo <span style="color:#e6db74">&#34;--------&#34;</span>
echo

<span style="color:#75715e"># Exit script if any command returns a non-zero status</span>
set -e

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -d <span style="color:#e6db74">&#34;/app/&lt;GITHUB-POST-REPO&gt;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
	echo <span style="color:#e6db74">&#34;Cloning research repo &#34;</span>

	cd /app/
	<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>ls -A &lt;GITHUB-POST-REPO&gt;<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
		echo <span style="color:#e6db74">&#34;clone here&#34;</span>
<span style="color:#75715e">#		This will need to be the PAT for the knowledge repo github account</span>
		git clone https://<span style="color:#e6db74">${</span>GITHUB_PAT<span style="color:#e6db74">}</span>@github.com/&lt;ORG&gt;/&lt;GITHUB-POST-REPO&gt;.git
	<span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">fi</span>
echo Runtime context <span style="color:#e6db74">${</span>RUNTIME_CONTEXT<span style="color:#e6db74">}</span>

echo
cd /app/
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>RUNTIME_CONTEXT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;local&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    echo Starting local server
    echo ---
    python scripts/knowledge_repo --repo ./&lt;GITHUB-POST-REPO&gt; --debug runserver --config ./server_config.py --port <span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span>
<span style="color:#66d9ef">else</span>
    echo Starting remote server
    echo ---
    python scripts/knowledge_repo --repo ./&lt;GITHUB-POST-REPO&gt; runserver --config ./server_config.py --port <span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span>

<span style="color:#66d9ef">fi</span></code></pre></div>

<h3 id="docker-compose-yml">docker-compose.yml</h3>

<p>This defines environment variables for your application e.g. github personal access token (PAT), sets what ports are mounted from your container externally and mounts the your app data volume into your container so any code changes can be immediately reflected with no rebuilds.</p>

<p>*This file should be added to your gitignore for deployment</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> &#39;3&#39;

<span style="color:#a6e22e">services</span><span style="color:#f92672">:</span>
  app:
    build:
      args:
<span style="color:#75715e">#This can be deleted for non-git backed repositories, it should be the PAT for your post-store account
</span><span style="color:#75715e"></span>        - GITHUB_PAT<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>GITHUB_PAT<span style="color:#e6db74">}</span>
      context: .
    ports:
      - <span style="color:#ae81ff">80</span>:80
    networks:
      - default
    volumes:
      - .:/app
    environment:
<span style="color:#75715e"># Fill in any Knowledge repo env variables here
</span><span style="color:#75715e"></span>      - PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
      - SERVER_NAME<span style="color:#f92672">=</span>localhost
      - RUNTIME_CONTEXT<span style="color:#f92672">=</span>local
</code></pre></div>

<h3 id="makefile">Makefile</h3>

<p>This aliases docker compose commands so you don&rsquo;t have to remember them.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span>
	docker-compose build

<span style="color:#a6e22e">shell</span><span style="color:#f92672">:</span>
	docker-compose run --rm app bash

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	docker system prune -f
	docker-compose stop
	docker rmi knowledgerepo_app

<span style="color:#a6e22e">run</span><span style="color:#f92672">:</span>
	docker-compose up
</code></pre></div>

		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373 0-.74-.24-1-.5L1 8a2.853 2.853 0 0 1-.7-1C.113 6.55 0 5.973 0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034 0 1.4 0h4.2c.373 0 .95.113 1.4.3.45.187.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/web-development/" rel="tag">web development</a></li>
	</ul>
</div>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Thomas Laber avatar" src="/img/tl.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Thomas Laber</span>
	</div>
	<div class="authorbox__description">
		&#34;Failure is not an option. 
 Everyone has to succeed.&#34; - Arnold Schwarzenegger
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/hugo_netlify/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Blogging with hugo netlify</p></a>
	</div>
</nav>


			</div>
			
<aside class="sidebar">
<div class="widget-toc" id="sticker">
	<h4 class="widget__title">Table of Content</h4>
	<div class="toc__menu">
		<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#activation">Activation</a></li>
<li><a href="#knowledge-repo-in-docker">Knowledge repo in docker</a>
<ul>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#start-sh">start.sh</a></li>
<li><a href="#docker-compose-yml">docker-compose.yml</a></li>
<li><a href="#makefile">Makefile</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
	</div>
</div>


</aside>

		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Web Archive.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>